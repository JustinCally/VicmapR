---
title: "How to Query Vicmap Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to Query Vicmap Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(dplyr)
library(VicmapR)
library(sf)
```

# How to Query Data

```{r query, eval = FALSE}
vicmap_query(layer = "datavic:VMHYDRO_WATERCOURSE_DRAIN")
```

```{r query_collect, eval = FALSE}
vicmap_query(layer = "datavic:VMHYDRO_WATERCOURSE_DRAIN") %>%
  head(50) %>%
  collect()
```

```{r show_query, eval = FALSE}
vicmap_query(layer = "datavic:VMHYDRO_WATERCOURSE_DRAIN") %>%
  head(50) %>%
  show_query()
```

```{r filter, eval = FALSE}
vicmap_query(layer = "datavic:VMHYDRO_WATERCOURSE_DRAIN") %>%
 filter(HIERARCHY == "L", PFI == 8553127) %>%
  collect()
```

```{r filter_spatial, eval = FALSE}
melbourne <- st_read(system.file("shapes/melbourne.geojson", package="VicmapR"))

vicmap_query(layer = "datavic:VMHYDRO_WATERCOURSE_DRAIN", CRS = 4326) %>%
#  filter(HIERARCHY == "L") %>%
  filter(BBOX(sf::st_bbox(melbourne))) %>%
  collect() %>%
  plot(max.plot = 2, lwd = 10, cex = 10)
```

```{r filter_spatial_2,eval=FALSE}
vicmap_query(layer = "datavic:VMHYDRO_WATERCOURSE_DRAIN", CRS = 4326, wfs_version = "1.0.0") %>%
#  filter(HIERARCHY == "L") %>%
  filter(CROSSES(melbourne %>% polygonFormat.sf())) %>%
  collect() 


```

